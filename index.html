<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星光璀璨，共赴朝夕</title>
    <!-- 引入中式书法字体 Ma Shan Zheng -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* ========== 全局重置与基础样式 ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ma Shan Zheng', cursive, serif;
            overflow-x: hidden;
            min-height: 100vh;
            color: #e0d8f0;
            background: #0a0a1a;
            cursor: default;
            -webkit-tap-highlight-color: transparent;
        }

        /* ========== 星空渐变背景 ========== */
        .starry-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #0a0a2e 0%, #1a0a3e 25%, #0d1b3e 50%, #1a0a3e 75%, #0a0a2e 100%);
            background-size: 400% 400%;
            animation: bgFlow 20s ease infinite;
            z-index: -3;
        }

        @keyframes bgFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ========== 星星闪烁层 ========== */
        .stars-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        /* ========== 中式水墨暗纹叠加 ========== */
        .ink-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.06;
            background-image:
                radial-gradient(ellipse at 20% 50%, rgba(100, 140, 200, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(140, 100, 200, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(80, 120, 180, 0.25) 0%, transparent 50%);
            background-size: 100% 100%;
            /* 水墨纹理用CSS模拟 */
            filter: blur(30px);
        }

        /* 额外水墨笔触装饰 */
        .ink-overlay::before {
            content: '';
            position: absolute;
            top: 10%; left: 5%;
            width: 300px; height: 300px;
            background: radial-gradient(ellipse, rgba(100, 150, 220, 0.15) 0%, transparent 70%);
            border-radius: 50% 40% 60% 30%;
            filter: blur(40px);
        }

        .ink-overlay::after {
            content: '';
            position: absolute;
            bottom: 15%; right: 10%;
            width: 250px; height: 250px;
            background: radial-gradient(ellipse, rgba(160, 120, 200, 0.12) 0%, transparent 70%);
            border-radius: 30% 60% 40% 50%;
            filter: blur(35px);
        }

        /* ========== 飘落花瓣容器 ========== */
        .petals-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            top: -30px;
            width: 12px;
            height: 16px;
            background: radial-gradient(ellipse at 30% 30%, rgba(150, 210, 255, 0.9), rgba(100, 170, 240, 0.5));
            border-radius: 50% 0 50% 50%;
            opacity: 0;
            animation: petalFall linear infinite;
            filter: blur(0.5px);
            box-shadow: 0 0 6px rgba(130, 200, 255, 0.3);
        }

        @keyframes petalFall {
            0% {
                opacity: 0;
                transform: translateY(0) translateX(0) rotate(0deg) scale(0.8);
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) translateX(80px) rotate(360deg) scale(0.4);
            }
        }

        /* ========== 鼠标跟随粒子容器 ========== */
        .particle-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0) translateY(-20px);
            }
        }

        /* ========== 主内容容器 ========== */
        .main-content {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* ========== 情人节倒计时 ========== */
        .countdown-section {
            margin-top: 20px;
            text-align: center;
            animation: fadeInDown 1.5s ease;
        }

        .countdown-label {
            font-size: 1.1rem;
            color: rgba(180, 200, 240, 0.8);
            letter-spacing: 3px;
            margin-bottom: 8px;
        }

        .countdown-timer {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .countdown-item {
            background: rgba(100, 140, 220, 0.1);
            border: 1px solid rgba(130, 170, 240, 0.25);
            border-radius: 12px;
            padding: 10px 14px;
            min-width: 70px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .countdown-num {
            font-size: 1.8rem;
            color: #a0c4ff;
            text-shadow: 0 0 10px rgba(130, 180, 255, 0.5);
            display: block;
            line-height: 1.2;
        }

        .countdown-unit {
            font-size: 0.8rem;
            color: rgba(180, 200, 240, 0.6);
            letter-spacing: 2px;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== 主标题 ========== */
        .main-title {
            margin-top: 30px;
            text-align: center;
            animation: fadeInDown 2s ease;
        }

        .main-title h1 {
            font-size: clamp(1.8rem, 5vw, 3rem);
            background: linear-gradient(135deg, #a0c4ff, #c4b5fd, #a0c4ff, #e0c3fc);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 4s ease infinite;
            text-shadow: none;
            filter: drop-shadow(0 0 20px rgba(160, 196, 255, 0.3));
            letter-spacing: 4px;
        }

        @keyframes titleShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .main-title .subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            color: rgba(180, 200, 240, 0.6);
            margin-top: 8px;
            letter-spacing: 6px;
        }

        /* ========== 3D旋转蓝色玫瑰区域 ========== */
        .rose-section {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 800px;
            index:999;
        }

        .rose-wrapper {
            position: relative;
            width: 220px;
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        /* 中式圆形描边 */
        .rose-circle {
            position: absolute;
            width: 210px;
            height: 210px;
            border: 2px solid rgba(130, 180, 240, 0.3);
            border-radius: 50%;
            animation: circleRotate 10s linear infinite;
        }

        .rose-circle::before {
            content: '';
            position: absolute;
            top: -4px; left: 50%;
            width: 8px; height: 8px;
            background: rgba(130, 200, 255, 0.8);
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(130, 200, 255, 0.6);
        }

        .rose-circle-inner {
            position: absolute;
            width: 190px;
            height: 190px;
            border: 1px dashed rgba(180, 160, 220, 0.2);
            border-radius: 50%;
            animation: circleRotate 15s linear infinite reverse;
        }

        @keyframes circleRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 3D玫瑰花 - SVG绘制 */
        .rose-3d {
            position: relative;
            width: 140px;
            height: 160px;
            animation: roseFloat 4s ease-in-out infinite;
            filter: drop-shadow(0 0 25px rgba(100, 170, 255, 0.6))
                    drop-shadow(0 0 50px rgba(130, 140, 220, 0.3));
        }

        .rose-3d svg {
            width: 100%;
            height: 100%;
        }

        @keyframes roseFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.03); }
        }

        /* 点击玫瑰提示 */
        .rose-hint {
            position: absolute;
            bottom: -50px;
            font-size: 0.8rem;
            color: rgba(160, 196, 255, 0.5);
            letter-spacing: 2px;
            animation: hintPulse 2s ease infinite;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* ========== 爱心+花瓣爆破动画 ========== */
        .burst-particle {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            animation: burstAnim 1.2s ease-out forwards;
        }

        .burst-heart {
            font-size: 20px;
            color: #7ec8ff;
            text-shadow: 0 0 10px rgba(130, 200, 255, 0.6);
        }

        .burst-petal-piece {
            width: 10px;
            height: 14px;
            background: linear-gradient(135deg, rgba(130, 200, 255, 0.9), rgba(160, 140, 220, 0.7));
            border-radius: 50% 0 50% 50%;
        }

        @keyframes burstAnim {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.3) rotate(var(--rot));
            }
        }

        /* ========== 打字机情话区域 ========== */
        .typewriter-section {
            margin-top: 50px;
            text-align: center;
            min-height: 60px;
        }

        .typewriter-text {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: #c4d5f7;
            letter-spacing: 4px;
            display: inline;
            text-shadow: 0 0 15px rgba(150, 190, 255, 0.3);
        }

        /* 毛笔笔触光标 */
        .typewriter-cursor {
            display: inline-block;
            width: 3px;
            height: 1.5em;
            background: linear-gradient(to bottom, rgba(200, 180, 140, 0.9), rgba(160, 140, 100, 0.3));
            margin-left: 4px;
            vertical-align: text-bottom;
            border-radius: 1px 1px 3px 0;
            animation: brushBlink 1s step-end infinite;
            /* 毛笔笔触：顶部粗底部细 */
            clip-path: polygon(0 0, 100% 0, 60% 100%, 0% 100%);
        }

        @keyframes brushBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* ========== 磨砂玻璃中式卡片 ========== */
        .cards-section {
            margin-top: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 24px;
            padding: 0 20px;
            max-width: 900px;
            width: 100%;
        }

        .glass-card {
            background: linear-gradient(165deg, rgba(25, 30, 70, 0.5), rgba(35, 25, 65, 0.45), rgba(20, 28, 60, 0.5));
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(140, 140, 230, 0.12);
            border-radius: 18px;
            padding: 34px 26px 28px;
            width: 260px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transform: translateY(0);
            box-shadow:
                0 4px 20px rgba(10, 10, 40, 0.3),
                inset 0 1px 0 rgba(180, 180, 255, 0.06);
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        box-shadow 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        border-color 0.6s ease;
        }

        /* 卡片顶部渐变装饰线 */
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 15%;
            width: 70%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(140, 160, 255, 0.4), rgba(180, 140, 230, 0.35), rgba(140, 160, 255, 0.4), transparent);
            border-radius: 0 0 2px 2px;
        }

        /* 卡片底部微光 */
        .glass-card::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 60px;
            background: radial-gradient(ellipse, rgba(130, 120, 240, 0.06) 0%, transparent 70%);
            pointer-events: none;
        }

        .glass-card:hover {
            transform: translateY(-6px);
            border-color: rgba(160, 140, 255, 0.35);
            box-shadow:
                0 0 15px rgba(140, 120, 255, 0.25),
                0 0 40px rgba(120, 100, 240, 0.15),
                0 0 80px rgba(100, 130, 255, 0.1),
                inset 0 0 25px rgba(140, 120, 255, 0.06);
            animation: cardGlow 3s ease-in-out infinite;
        }

        @keyframes cardGlow {
            0% {
                box-shadow:
                    0 0 15px rgba(140, 120, 255, 0.25),
                    0 0 40px rgba(120, 100, 240, 0.15),
                    0 0 80px rgba(100, 130, 255, 0.1),
                    inset 0 0 25px rgba(140, 120, 255, 0.06);
                border-color: rgba(160, 140, 255, 0.35);
            }
            50% {
                box-shadow:
                    0 0 20px rgba(120, 140, 255, 0.3),
                    0 0 50px rgba(150, 120, 240, 0.2),
                    0 0 90px rgba(130, 110, 255, 0.12),
                    inset 0 0 30px rgba(130, 140, 255, 0.08);
                border-color: rgba(140, 160, 255, 0.4);
            }
            100% {
                box-shadow:
                    0 0 15px rgba(140, 120, 255, 0.25),
                    0 0 40px rgba(120, 100, 240, 0.15),
                    0 0 80px rgba(100, 130, 255, 0.1),
                    inset 0 0 25px rgba(140, 120, 255, 0.06);
                border-color: rgba(160, 140, 255, 0.35);
            }
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: 14px;
            display: block;
            filter: drop-shadow(0 0 10px rgba(140, 150, 255, 0.35));
        }

        .card-title {
            font-size: 1.3rem;
            color: #c8d8f8;
            margin-bottom: 14px;
            letter-spacing: 4px;
            position: relative;
            display: inline-block;
        }

        /* 标题下方小装饰线 */
        .card-title::after {
            content: '';
            display: block;
            width: 28px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(160, 150, 240, 0.5), transparent);
            margin: 8px auto 0;
        }

        .card-text {
            font-size: 0.95rem;
            color: rgba(190, 200, 235, 0.65);
            line-height: 1.9;
            letter-spacing: 1.5px;
        }

        /* ========== 惊喜按钮 ========== */
        .surprise-btn {
            margin-top: 50px;
            padding: 14px 40px;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.2rem;
            color: #c4d5f7;
            background: linear-gradient(135deg, rgba(80, 120, 200, 0.3), rgba(140, 100, 200, 0.3));
            border: 1px solid rgba(130, 180, 240, 0.3);
            border-radius: 50px;
            cursor: pointer;
            letter-spacing: 4px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .surprise-btn::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(130, 200, 255, 0.15);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .surprise-btn:hover {
            border-color: rgba(130, 200, 255, 0.6);
            box-shadow: 0 0 30px rgba(100, 170, 255, 0.2), inset 0 0 20px rgba(100, 170, 255, 0.05);
            transform: scale(1.05);
        }

        .surprise-btn:hover::before {
            width: 300px; height: 300px;
        }

        /* ========== 惊喜弹窗（情书样式） ========== */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(5, 5, 20, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-box {
            background: linear-gradient(160deg, rgba(18, 24, 55, 0.85), rgba(25, 18, 50, 0.9));
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(140, 130, 220, 0.25);
            border-radius: 20px;
            padding: 0;
            max-width: 420px;
            width: 90%;
            text-align: center;
            transform: scale(0.85) translateY(20px);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            box-shadow:
                0 0 40px rgba(120, 100, 200, 0.15),
                0 0 80px rgba(100, 120, 220, 0.08),
                inset 0 1px 0 rgba(200, 190, 255, 0.1);
        }

        .modal-overlay.active .modal-box {
            transform: scale(1) translateY(0);
        }

        /* 信封顶部装饰条 */
        .modal-header-deco {
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(140, 160, 255, 0.5), rgba(180, 140, 220, 0.5), rgba(140, 160, 255, 0.5), transparent);
            margin-bottom: 0;
        }

        /* 情书内容区 */
        .modal-letter {
            padding: 32px 28px 24px;
            position: relative;
            background-image: url(./iloveyou.png);
            background-size: 50%;
            background-repeat: no-repeat;
            background-position: left 40px bottom 10px;
        }

        /* 左上角装饰花纹 */
        .modal-letter::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 14px;
            font-size: 1.1rem;
            opacity: 0.2;
            color: #c4b5fd;
            /* 新增：承载第二张图片 */
            width: 30%;
            height: 40%;
            background-image: url(./2.png);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: right top;
            pointer-events: none; /* 避免遮挡内容点击 */

            /* 核心：透明度动画 */
            animation: opacityChange 1s infinite alternate;
        }

        /* 右下角装饰花纹 */
        .modal-letter::after {
            content: '❀';
            position: absolute;
            bottom: 10px;
            left: 14px;
            font-size: 1.1rem;
            opacity: 0.2;
            color: #93c5fd;
        }
        /* 定义透明度动画 */
        @keyframes opacityChange {
        0% { opacity: 0.1; }
        100% { opacity: 1; }
        }
        /* 称呼 - 左上角 */
        .modal-addressee {
            text-align: left;
            font-size: 1.05rem;
            color: rgba(190, 200, 240, 0.7);
            letter-spacing: 2px;
            margin-bottom: 20px;
            padding-left: 4px;
        }

        .modal-icon {
            font-size: 1.6rem;
            display: inline-block;
            margin-bottom: 16px;
            animation: modalFloat 3s ease infinite;
            filter: drop-shadow(0 0 8px rgba(140, 130, 255, 0.4));
        }

        @keyframes modalFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .modal-text {
            font-size: 1.3rem;
            color: #d0d8f8;
            line-height: 2.2;
            letter-spacing: 3px;
            margin-bottom: 24px;
            padding: 0 8px;
        }

        /* 落款 - 右下角 */
        .modal-signature {
            text-align: right;
            padding-right: 4px;
            margin-bottom: 20px;
        }

        .modal-signature .sig-line {
            display: block;
            font-size: 0.95rem;
            color: rgba(180, 190, 230, 0.6);
            letter-spacing: 2px;
            line-height: 1.8;
        }

        .modal-signature .sig-name {
            font-size: 1.15rem;
            color: rgba(200, 190, 240, 0.8);
            letter-spacing: 3px;
        }

        /* 分隔线 */
        .modal-divider {
            width: 50px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(160, 150, 240, 0.4), transparent);
            margin: 0 auto 20px;
        }

        .modal-close {
            padding: 10px 32px;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1rem;
            color: rgba(190, 200, 240, 0.85);
            background: rgba(120, 110, 200, 0.12);
            border: 1px solid rgba(150, 140, 230, 0.2);
            border-radius: 30px;
            cursor: pointer;
            letter-spacing: 3px;
            transition: all 0.4s ease;
            margin-bottom: 8px;
            margin-top: 8px;
        }

        .modal-close:hover {
            background: rgba(130, 120, 220, 0.25);
            border-color: rgba(160, 150, 240, 0.45);
            box-shadow: 0 0 20px rgba(140, 130, 240, 0.15);
        }

        /* 底部装饰条 */
        .modal-footer-deco {
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(140, 160, 255, 0.3), rgba(180, 140, 220, 0.3), rgba(140, 160, 255, 0.3), transparent);
        }

        /* ========== 长按彩蛋区域 ========== */
        .easter-egg-zone {
            margin-top: 50px;
            padding: 20px 30px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            position: relative;
        }

        .easter-egg-hint {
            font-size: 0.9rem;
            color: rgba(160, 180, 220, 0.4);
            letter-spacing: 3px;
            transition: color 0.3s ease;
        }

        .easter-egg-hint:hover {
            color: rgba(160, 180, 220, 0.6);
        }

        .easter-egg-content {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease, transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: opacity, transform;
            /* 旋转炫光边框容器 */
            padding: 2px;
            border-radius: 22px;
            background: rgba(15, 20, 50, 0.6);
            max-width: 380px;
            width: 85%;
        }

        .easter-egg-content.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        /* 旋转炫光边框 */
        .easter-egg-content::before {
            content: '';
            position: absolute;
            top: -1px; left: -1px;
            right: -1px; bottom: -1px;
            border-radius: 22px;
            background: conic-gradient(
                from var(--egg-angle, 0deg),
                transparent 0%,
                rgba(140, 130, 255, 0.5) 10%,
                rgba(100, 180, 255, 0.3) 20%,
                transparent 30%,
                transparent 50%,
                rgba(180, 140, 240, 0.4) 60%,
                rgba(120, 160, 255, 0.3) 70%,
                transparent 80%
            );
            z-index: -1;
            animation: eggBorderSpin 4s linear infinite;
        }

        @keyframes eggBorderSpin {
            to { --egg-angle: 360deg; }
        }

        /* 注册自定义属性以支持动画 */
        @property --egg-angle {
            syntax: '<angle>';
            initial-value: 0deg;
            inherits: false;
        }

        /* 外层光晕（静态box-shadow + opacity呼吸，GPU友好） */
        .easter-egg-content::after {
            content: '';
            position: absolute;
            top: -6px; left: -6px;
            right: -6px; bottom: -6px;
            border-radius: 26px;
            box-shadow:
            /* 内阴影：向内收缩 2px，保留原有模糊/透明度 */
            inset 0 0 20px 2px rgba(140, 130, 255, 0.15),
            inset 0 0 50px 2px rgba(120, 140, 255, 0.08),
            /* 如需保留原有外阴影，可保留这两行（可选） */
            0 0 20px rgba(140, 130, 255, 0.15),
            0 0 50px rgba(120, 140, 255, 0.08);
            z-index: -2;
            animation: eggGlowPulse 3s ease-in-out infinite alternate;
            will-change: opacity;
        }

        @keyframes eggGlowPulse {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* 内容区 */
        .easter-egg-inner {
            background: linear-gradient(160deg, rgba(15, 18, 48, 0.92), rgba(22, 16, 45, 0.95));
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 20px;
            padding: 36px 30px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        .egg-rose-bg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url(./蓝色玫瑰.png);
            background-size: 62%;
            background-repeat: no-repeat;
            background-position: center;
            pointer-events: none;
            opacity: 0.1;
            animation: eggBgFade 3s ease-in-out infinite alternate;
            animation-play-state: paused;
            will-change: opacity;
        }

        .easter-egg-content.show .egg-rose-bg {
            animation-play-state: running;
            animation-delay: 0.4s;
        }

        /* 内部微光效果（仅动画opacity，GPU加速流畅） */
        .easter-egg-inner::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(140, 130, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(100, 170, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 50% 10%, rgba(180, 140, 240, 0.06) 0%, transparent 40%);
            pointer-events: none;
            animation: innerShimmer 4s ease-in-out infinite alternate;
            will-change: opacity;
        }

        @keyframes innerShimmer {
            0% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        @keyframes eggBgFade {
            0% { opacity: 0.1; }
            100% { opacity: 1; }
        }

        /* ========== 玫瑰花瓣飘落特效 ========== */
        .rose-rain {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 3001;
            overflow: hidden;
            opacity: 1;
            transition: opacity 1.2s ease;
        }

        .rose-rain.fading {
            opacity: 0;
        }

        .rose-petal {
            position: absolute;
            top: -60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation:
                petalFall var(--fall-dur) linear var(--fall-delay) infinite,
                petalSway var(--sway-dur) ease-in-out var(--fall-delay) infinite alternate,
                petalSpin var(--spin-dur) linear var(--fall-delay) infinite;
            opacity: 0;
            will-change: transform, opacity;
        }

        @keyframes petalFall {
            0% {
                top: -60px;
                opacity: 0;
            }
            5% {
                opacity: var(--petal-opacity);
            }
            85% {
                opacity: var(--petal-opacity);
            }
            100% {
                top: 110vh;
                opacity: 0;
            }
        }

        @keyframes petalSway {
            0% {
                transform: translateX(calc(var(--sway-range) * -1));
            }
            100% {
                transform: translateX(var(--sway-range));
            }
        }

        @keyframes petalSpin {
            0% { rotate: 0deg; }
            100% { rotate: var(--spin-dir); }
        }

        /* 古典角花装饰 - 左上 */
        .egg-corner-tl, .egg-corner-tr, .egg-corner-bl, .egg-corner-br {
            position: absolute;
            width: 24px;
            height: 24px;
            opacity: 0.25;
            color: #c4b5fd;
            pointer-events: none;
        }
        .egg-corner-tl { top: 10px; left: 12px; }
        .egg-corner-tr { top: 10px; right: 12px; transform: scaleX(-1); }
        .egg-corner-bl { bottom: 10px; left: 12px; transform: scaleY(-1); }
        .egg-corner-br { bottom: 10px; right: 12px; transform: scale(-1, -1); }

        .egg-corner-tl::before, .egg-corner-tr::before,
        .egg-corner-bl::before, .egg-corner-br::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 18px; height: 1px;
            background: linear-gradient(90deg, rgba(180, 170, 240, 0.6), transparent);
        }
        .egg-corner-tl::after, .egg-corner-tr::after,
        .egg-corner-bl::after, .egg-corner-br::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 1px; height: 18px;
            background: linear-gradient(180deg, rgba(180, 170, 240, 0.6), transparent);
        }

        /* 顶部装饰图标 */
        .egg-top-icon {
            font-size: 1.4rem;
            display: block;
            margin-bottom: 16px;
            filter: drop-shadow(0 0 12px rgba(140, 130, 255, 0.5));
            animation: eggIconFloat 3s ease-in-out infinite;
        }

        @keyframes eggIconFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-4px) scale(1.05); }
        }

        .easter-egg-text {
            font-size: 1.3rem;
            color: #d0d8f8;
            line-height: 2.4;
            letter-spacing: 3px;
            margin-bottom: 6px;
            position: relative;
        }

        /* 文字上下装饰线 */
        .egg-text-line {
            display: block;
            width: 40px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(160, 150, 240, 0.45), transparent);
            margin: 12px auto;
        }

        .easter-egg-deco {
            margin-top: 8px;
            font-size: 0.85rem;
            color: rgba(180, 170, 230, 0.4);
            letter-spacing: 4px;
        }

        /* ========== 音乐控制按钮 ========== */
        .music-btn {
            position: fixed;
            top: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(30, 40, 80, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(130, 180, 240, 0.25);
            color: #a0c4ff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 5000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .music-btn:hover {
            background: rgba(50, 60, 100, 0.5);
            border-color: rgba(130, 200, 255, 0.5);
            box-shadow: 0 0 15px rgba(100, 170, 255, 0.2);
        }

        .music-icon {
            animation: musicSpin 2s linear infinite;
            animation-play-state: paused;
        }

        .music-btn.playing .music-icon {
            animation-play-state: running;
        }

        @keyframes musicSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ========== 底部装饰 ========== */
        .footer-deco {
            margin-top: 60px;
            margin-bottom: 40px;
            text-align: center;
            opacity: 0.4;
        }

        .footer-deco .line {
            display: inline-block;
            width: 60px;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(130, 180, 240, 0.5), transparent);
            vertical-align: middle;
            margin: 0 12px;
        }

        .footer-deco .dot {
            font-size: 0.6rem;
            color: rgba(130, 180, 240, 0.6);
        }

        .footer-text {
            margin-top: 10px;
            font-size: 0.85rem;
            color: rgba(160, 180, 220, 0.3);
            letter-spacing: 4px;
        }

        /* ========== 响应式适配 ========== */
        @media (max-width: 768px) {
            .cards-section {
                flex-direction: column;
                align-items: center;
            }

            .glass-card {
                width: 90%;
                max-width: 320px;
            }

            .countdown-item {
                min-width: 60px;
                padding: 8px 10px;
            }

            .countdown-num {
                font-size: 1.5rem;
            }

            .rose-wrapper {
                width: 180px;
                height: 180px;
            }

            .rose-circle {
                width: 170px;
                height: 170px;
            }

            .rose-circle-inner {
                width: 155px;
                height: 155px;
            }

            .rose-3d {
                width: 100px;
                height: 100px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }

            .countdown-item {
                min-width: 55px;
                padding: 6px 8px;
            }

            .surprise-btn {
                padding: 12px 30px;
                font-size: 1.1rem;
            }
        }

        /* ========== 加载动画 ========== */
        .page-loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #0a0a1a;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease;
        }

        .page-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-text {
            font-size: 1.5rem;
            color: #a0c4ff;
            letter-spacing: 6px;
            animation: loaderPulse 1.5s ease infinite;
        }

        @keyframes loaderPulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        /* ========== 圆形音乐播放器 ========== */
        .music-player-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 6000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.45s ease;
            background: rgba(0, 0, 0, 0.35);
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: opacity;
        }

        .music-player-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .music-player-card {
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: #0a0d1e;
            border: 1px solid rgba(130, 180, 255, 0.15);
            box-shadow:
                0 0 50px rgba(100, 140, 255, 0.12),
                0 0 100px rgba(80, 100, 200, 0.06),
                inset 0 1px 0 rgba(200, 200, 255, 0.06);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transform: scale(0.7) translateZ(0);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: transform;
        }

        .music-player-overlay.active .music-player-card {
            transform: scale(1) translateZ(0);
        }

        /* CD纹理贴图（垫底，占满整个圆） */
        .mp-cd-texture {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            opacity: 0.15;
        }

        @keyframes mpCdSpin {
            to { transform: rotate(360deg); }
        }

        /* 专辑封面图（居中，占卡片38%） */
        .mp-cover-img {
            position: absolute;
            width: 38%; height: 38%;
            top: 31%; left: 31%;
            box-sizing: border-box;
            border-radius: 50%;
            object-fit: cover;
            z-index: 1;
            border: 2px solid rgba(180, 200, 255, 0.2);
            box-shadow:
                0 0 12px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(100, 140, 255, 0.08);
            pointer-events: none;
            animation: mpCdSpin 15s linear infinite;
            animation-play-state: paused;
        }

        .music-player-card.playing .mp-cover-img {
            animation-play-state: running;
        }

        /* 炫光边框 */
        .music-player-card::before {
            content: '';
            position: absolute;
            top: -3px; left: -3px;
            right: -3px; bottom: -3px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                transparent 0%,
                rgba(100, 160, 255, 0.5) 8%,
                transparent 18%,
                transparent 45%,
                rgba(160, 120, 255, 0.4) 55%,
                transparent 65%,
                transparent 85%,
                rgba(100, 200, 255, 0.25) 92%,
                transparent 100%
            );
            z-index: -1;
            animation: mpBorderSpin 15s linear infinite;
            animation-play-state: paused;
        }

        .music-player-card::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            box-shadow:
                inset 0 0 50px rgba(0, 0, 0, 0.3),
                inset 0 0 20px rgba(100, 140, 255, 0.05);
            z-index: 3;
            pointer-events: none;
        }

        .music-player-card.playing::before {
            animation-play-state: running;
        }

        @keyframes mpBorderSpin {
            to { transform: rotate(360deg); }
        }

        /* 歌曲信息 */
        .mp-song-name {
            font-size: 1rem;
            font-weight: 600;
            color: #d0d8ff;
            letter-spacing: 2px;
            margin-top: 28px;
            text-align: center;
            max-width: 200px;
            z-index: 4;
            position: relative;
            text-shadow: 0 1px 8px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mp-artist {
            font-size: 0.75rem;
            color: rgba(160, 180, 220, 0.7);
            margin-top: 2px;
            letter-spacing: 1px;
            z-index: 4;
            position: relative;
            text-shadow: 0 1px 6px rgba(0,0,0,0.4);
        }

        /* 中心区域（歌词+播放键叠加） */
        .mp-center-area {
            position: relative;
            width: 240px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 6px;
            z-index: 4;
        }

        /* 歌词滚动区 */
        .mp-lyrics-box {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(transparent, #000 15%, #000 85%, transparent);
            -webkit-mask-image: linear-gradient(transparent, #000 15%, #000 85%, transparent);
        }

        .mp-lyrics-inner {
            transition: transform 0.5s ease;
        }

        .mp-lyric-line {
            text-align: center;
            font-size: 0.72rem;
            color: rgba(160, 180, 220, 0.45);
            line-height: 1.8;
            transition: color 0.4s ease, transform 0.4s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 5px;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7), 0 0 8px rgba(0, 0, 0, 0.4);
        }

        .mp-lyric-line.active {
            color: #a0c4ff;
            transform: scale(1.08);
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.8), 0 0 12px rgba(80, 120, 255, 0.3);
        }

        /* 播放/暂停按钮（居中叠加在歌词上） */
        .mp-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(15, 18, 48, 0.7);
            border: 1px solid rgba(130, 180, 255, 0.35);
            color: #a0c4ff;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            opacity: 1;
            transition: opacity 0.8s ease, background 0.25s ease, transform 0.25s ease;
        }

        .mp-play-btn:hover {
            background: rgba(100, 140, 255, 0.35);
            border-color: rgba(130, 180, 255, 0.6);
        }

        .mp-play-btn.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .mp-center-area:hover .mp-play-btn.hidden {
            opacity: 0.85;
            pointer-events: auto;
        }

        /* 进度条 */
        .mp-progress-wrap {
            width: 200px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 4;
            position: relative;
        }

        .mp-time {
            font-size: 0.6rem;
            color: rgba(160, 180, 220, 0.5);
            min-width: 30px;
            text-align: center;
        }

        .mp-progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(100, 140, 255, 0.15);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .mp-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(100, 160, 255, 0.6), rgba(160, 120, 255, 0.6));
            border-radius: 2px;
            width: 0%;
            position: relative;
        }

        .mp-progress-fill::after {
            content: '';
            position: absolute;
            right: -4px;
            top: -3px;
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #a0c4ff;
            box-shadow: 0 0 6px rgba(100, 160, 255, 0.5);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .mp-progress-bar:hover .mp-progress-fill::after {
            opacity: 1;
        }

        /* 音量 + 歌词开关 */
        .mp-bottom-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 6px;
            margin-bottom: 20px;
            z-index: 4;
            position: relative;
        }

        .mp-vol-wrap {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .mp-vol-icon {
            font-size: 0.75rem;
            color: rgba(160, 180, 220, 0.6);
            cursor: pointer;
        }

        .mp-vol-bar {
            width: 50px;
            height: 3px;
            background: rgba(100, 140, 255, 0.15);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .mp-vol-fill {
            height: 100%;
            background: rgba(100, 160, 255, 0.5);
            border-radius: 2px;
            width: 30%;
        }

        .mp-lrc-toggle {
            font-size: 0.65rem;
            color: rgba(160, 180, 220, 0.5);
            background: rgba(100, 140, 255, 0.1);
            border: 1px solid rgba(130, 180, 255, 0.15);
            border-radius: 10px;
            padding: 2px 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mp-lrc-toggle.on {
            color: #a0c4ff;
            background: rgba(100, 140, 255, 0.25);
            border-color: rgba(130, 180, 255, 0.4);
        }

        /* 左右切歌箭头 */
        .mp-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(20, 30, 60, 0.7);
            border: 1px solid rgba(130, 180, 255, 0.2);
            color: #a0c4ff;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            z-index: 10;
        }

        .mp-arrow:hover {
            background: rgba(40, 60, 120, 0.8);
            border-color: rgba(130, 180, 255, 0.5);
            box-shadow: 0 0 12px rgba(100, 160, 255, 0.2);
        }

        .mp-arrow-left {
            left: -50px;
        }

        .mp-arrow-right {
            right: -50px;
        }

        /* 全局底部歌词 */
        .global-lyrics-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 5500;
            text-align: center;
            padding: 10px 20px;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .global-lyrics-bar.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .global-lyric-text {
            display: inline-block;
            font-size: 0.9rem;
            color: rgba(180, 200, 255, 0.85);
            text-shadow:
                0 0 20px rgba(100, 140, 255, 0.4),
                0 0 40px rgba(80, 100, 200, 0.2);
            letter-spacing: 3px;
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(90deg, rgba(100, 160, 255, 0.08), rgba(160, 120, 255, 0.08));
            padding: 6px 24px;
            border-radius: 20px;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(130, 180, 255, 0.1);
        }

        /* 响应式 */
        @media (max-width: 600px) {
            .music-player-card {
                width: 280px;
                height: 280px;
            }
            .mp-center-area {
                width: 200px;
                height: 100px;
            }
            .mp-progress-wrap {
                width: 170px;
            }
            .mp-arrow-left { left: -42px; }
            .mp-arrow-right { right: -42px; }
            .mp-song-name { margin-top: 22px; font-size: 0.9rem; }
        }

    </style>
</head>
<body>

    <!-- 页面加载动画 -->
    <div class="page-loader" id="pageLoader">
        <span class="loader-text">蓝玫映星河...</span>
    </div>

    <!-- 星空渐变背景 -->
    <div class="starry-bg"></div>

    <!-- 星星闪烁画布 -->
    <canvas class="stars-canvas" id="starsCanvas"></canvas>

    <!-- 中式水墨暗纹 -->
    <div class="ink-overlay"></div>

    <!-- 飘落花瓣容器 -->
    <div class="petals-container" id="petalsContainer"></div>

    <!-- 鼠标跟随粒子容器 -->
    <div class="particle-container" id="particleContainer"></div>

    <!-- 音乐控制按钮 -->
    <button class="music-btn" id="musicBtn" title="背景音乐（长按打开播放器）">
        <span class="music-icon">♪</span>
    </button>

    <!-- 圆形音乐播放器 -->
    <div class="music-player-overlay" id="mpOverlay">
        <div style="position:relative;display:inline-flex;align-items:center;justify-content:center;">
            <button class="mp-arrow mp-arrow-left" id="mpPrev">‹</button>
            <div class="music-player-card" id="mpCard">
                <img class="mp-cd-texture" src="./CD纹理贴图.png" alt="cd">
                <img class="mp-cover-img" id="mpCoverImg" src="./pic/1.jpg" alt="cover">
                <div class="mp-song-name" id="mpSongName">歌曲1</div>
                <div class="mp-artist" id="mpArtist">歌手1</div>
                <div class="mp-center-area" id="mpCenterArea">
                    <div class="mp-lyrics-box">
                        <div class="mp-lyrics-inner" id="mpLyricsInner"></div>
                    </div>
                    <button class="mp-play-btn" id="mpPlayBtn" title="播放/暂停">▶</button>
                </div>
                <div class="mp-progress-wrap">
                    <span class="mp-time" id="mpTimeCur">0:00</span>
                    <div class="mp-progress-bar" id="mpProgressBar">
                        <div class="mp-progress-fill" id="mpProgressFill"></div>
                    </div>
                    <span class="mp-time" id="mpTimeDur">0:00</span>
                </div>
                <div class="mp-bottom-row">
                    <div class="mp-vol-wrap">
                        <span class="mp-vol-icon">🔊</span>
                        <div class="mp-vol-bar" id="mpVolBar">
                            <div class="mp-vol-fill" id="mpVolFill"></div>
                        </div>
                    </div>
                    <button class="mp-lrc-toggle" id="mpLrcToggle">词</button>
                </div>
            </div>
            <button class="mp-arrow mp-arrow-right" id="mpNext">›</button>
        </div>
    </div>

    <!-- 全局底部歌词 -->
    <div class="global-lyrics-bar" id="globalLyricsBar">
        <span class="global-lyric-text" id="globalLyricText"></span>
    </div>

    <!-- 主内容 -->
    <div class="main-content">

        <!-- 情人节倒计时 -->
        <section class="countdown-section">
            <div class="countdown-label">— 距离情人节 —</div>
            <div class="countdown-timer" id="countdownTimer">
                <div class="countdown-item">
                    <span class="countdown-num" id="cdDays">0</span>
                    <span class="countdown-unit">天</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-num" id="cdHours">0</span>
                    <span class="countdown-unit">时</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-num" id="cdMins">0</span>
                    <span class="countdown-unit">分</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-num" id="cdSecs">0</span>
                    <span class="countdown-unit">秒</span>
                </div>
            </div>
        </section>

        <!-- 主标题 - 可修改文案 -->
        <section class="main-title">
            <h1>星光璀璨，共赴朝夕</h1>
            <div class="subtitle">青衿寄情 · 蓝玫予你</div>
        </section>

        <!-- 3D旋转蓝色玫瑰 -->
        <section class="rose-section">
            <div class="rose-wrapper" id="roseWrapper">
                <div class="rose-circle"></div>
                <div class="rose-circle-inner"></div>
                <div class="rose-3d" id="rose3d">
                    <svg viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <radialGradient id="rg1" cx="50%" cy="40%"><stop offset="0%" stop-color="#c7e2ff"/><stop offset="100%" stop-color="#4a8ee6"/></radialGradient>
                            <radialGradient id="rg2" cx="50%" cy="40%"><stop offset="0%" stop-color="#a8d4ff"/><stop offset="100%" stop-color="#5b6abf"/></radialGradient>
                            <radialGradient id="rg3" cx="50%" cy="40%"><stop offset="0%" stop-color="#b8e0ff"/><stop offset="100%" stop-color="#6e7fd9"/></radialGradient>
                            <radialGradient id="rg4" cx="50%" cy="50%"><stop offset="0%" stop-color="#dbeeff"/><stop offset="100%" stop-color="#7baae8"/></radialGradient>
                            <radialGradient id="rg5" cx="50%" cy="40%"><stop offset="0%" stop-color="#e8f4ff"/><stop offset="100%" stop-color="#90b8f0"/></radialGradient>
                            <radialGradient id="rgCore" cx="50%" cy="50%"><stop offset="0%" stop-color="#f0f7ff"/><stop offset="60%" stop-color="#c4dcf8"/><stop offset="100%" stop-color="#8ab4e8"/></radialGradient>
                            <filter id="roseGlow"><feGaussianBlur stdDeviation="1.5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                        </defs>
                        <!-- 花茎 -->
                        <path d="M100 158 Q99 180 97 210 Q96 235 97 255" stroke="#4ade80" stroke-width="3" fill="none" opacity="0.65"/>
                        <!-- 叶子 -->
                        <path d="M97 195 Q82 185 72 190 Q80 180 97 188" fill="#4ade80" opacity="0.45"/>
                        <path d="M97 218 Q112 210 120 214 Q110 220 97 215" fill="#4ade80" opacity="0.45"/>
                        <!-- 花萼 -->
                        <path d="M92 158 Q87 150 82 156 Q89 153 96 160" fill="#34d399" opacity="0.55"/>
                        <path d="M108 158 Q113 150 118 156 Q111 153 104 160" fill="#34d399" opacity="0.55"/>
                        <path d="M100 156 Q100 148 100 155" stroke="#34d399" stroke-width="2" fill="none" opacity="0.4"/>

                        <!-- === 花朵实心底色（消除所有缝隙） === -->
                        <ellipse cx="100" cy="105" rx="52" ry="50" fill="#5a8fd4" opacity="1"/>

                        <!-- === 外层花瓣（5片，大而圆润） === -->
                        <path d="M100 60 Q125 45 145 60 Q160 80 150 110 Q140 135 115 145 Q100 130 100 100 Z" fill="url(#rg1)" filter="url(#roseGlow)"/>
                        <path d="M100 60 Q75 45 55 60 Q40 80 50 110 Q60 135 85 145 Q100 130 100 100 Z" fill="url(#rg2)" filter="url(#roseGlow)"/>
                        <path d="M55 75 Q38 95 45 120 Q55 148 85 155 Q95 140 90 115 Q85 90 70 75 Z" fill="url(#rg3)" filter="url(#roseGlow)"/>
                        <path d="M145 75 Q162 95 155 120 Q145 148 115 155 Q105 140 110 115 Q115 90 130 75 Z" fill="url(#rg1)" filter="url(#roseGlow)"/>
                        <path d="M65 60 Q50 70 48 95 Q48 120 65 140 Q80 148 95 140 Q85 120 78 95 Q72 72 75 60 Z" fill="url(#rg2)" opacity="0.9"/>

                        <!-- === 中层花瓣（4片，稍小，覆盖内部） === -->
                        <path d="M100 70 Q120 62 135 78 Q145 100 130 130 Q115 145 100 135 Q100 115 100 95 Z" fill="url(#rg4)" opacity="0.92"/>
                        <path d="M100 70 Q80 62 65 78 Q55 100 70 130 Q85 145 100 135 Q100 115 100 95 Z" fill="url(#rg3)" opacity="0.92"/>
                        <path d="M60 90 Q55 110 65 130 Q78 148 100 140 Q95 125 88 108 Q80 92 68 85 Z" fill="url(#rg5)" opacity="0.88"/>
                        <path d="M140 90 Q145 110 135 130 Q122 148 100 140 Q105 125 112 108 Q120 92 132 85 Z" fill="url(#rg4)" opacity="0.88"/>

                        <!-- === 内层花瓣（4片，紧密包裹中心） === -->
                        <path d="M100 80 Q115 78 125 92 Q130 110 118 130 Q108 138 100 130 Q100 112 100 95 Z" fill="url(#rg5)" opacity="0.93"/>
                        <path d="M100 80 Q85 78 75 92 Q70 110 82 130 Q92 138 100 130 Q100 112 100 95 Z" fill="url(#rg4)" opacity="0.93"/>
                        <path d="M78 95 Q72 108 78 125 Q88 138 100 132 Q96 120 92 108 Q88 98 82 92 Z" fill="url(#rg5)" opacity="0.9"/>
                        <path d="M122 95 Q128 108 122 125 Q112 138 100 132 Q104 120 108 108 Q112 98 118 92 Z" fill="url(#rg4)" opacity="0.9"/>

                        <!-- === 花蕊卷曲（螺旋形，填满中心） === -->
                        <path d="M100 88 Q110 86 115 98 Q118 112 108 125 Q100 130 100 118 Q100 105 100 95 Z" fill="#d4e8fc" opacity="0.94"/>
                        <path d="M100 88 Q90 86 85 98 Q82 112 92 125 Q100 130 100 118 Q100 105 100 95 Z" fill="#ddeeff" opacity="0.94"/>
                        <path d="M95 95 Q88 105 92 118 Q97 128 100 122 Q98 112 96 102 Z" fill="#e6f1ff" opacity="0.92"/>
                        <path d="M105 95 Q112 105 108 118 Q103 128 100 122 Q102 112 104 102 Z" fill="#e0edff" opacity="0.92"/>

                        <!-- === 花蕊中心（实心，最亮） === -->
                        <ellipse cx="100" cy="110" rx="12" ry="14" fill="url(#rgCore)" opacity="0.95"/>
                        <ellipse cx="100" cy="108" rx="7" ry="8" fill="#f0f7ff" opacity="0.9"/>
                        <ellipse cx="100" cy="107" rx="3" ry="4" fill="#ffffff" opacity="0.7"/>
                    </svg>
                </div>
                <span class="rose-hint">轻触玫瑰，绽放心意</span>
            </div>
        </section>

        <!-- 诗句环绕 -->
        <link rel="stylesheet" href="wordsky.css">
        <div class="container"></div>
        <script src="wordsky.js"></script>

        <!-- 打字机情话 -->
        <section class="typewriter-section">
            <span class="typewriter-text" id="typewriterText"></span>
            <span class="typewriter-cursor"></span>
        </section>

        <!-- 磨砂玻璃中式卡片 - 可修改文案 -->
        <section class="cards-section">
            <div class="glass-card">
                <span class="card-icon">🌙</span>
                <div class="card-title">笪月栖思</div>
                <div class="card-text">思君如满月，夜夜减清辉。<br>山海无涯，此心可栖。</div>
            </div>
            <div class="glass-card">
                <span class="card-icon">🏔️</span>
                <div class="card-title">鸣心撼岳</div>
                <div class="card-text">山海有盟誓，江海亦倾心。<br>死生契阔，与子同衾。</div>
            </div>
            <div class="glass-card">
                <span class="card-icon">🎐</span>
                <div class="card-title">璨铃萦吟</div>
                <div class="card-text">风铃摇碎月，清响入君心。<br>念念在兹，朝暮如吟。</div>
            </div>
        </section>

        <!-- 惊喜按钮 -->
        <button class="surprise-btn" id="surpriseBtn">
            ✦ 启封一封情书 ✦
        </button>

        <!-- 长按彩蛋区域 -->
        <div class="easter-egg-zone" id="easterEggZone">
            <div class="easter-egg-hint">「 长按此处，聆听心声 」</div>
        </div>

        <!-- 底部装饰 -->
        <div class="footer-deco">
            <span class="line"></span>
            <span class="dot">◆</span>
            <span class="line"></span>
            <div class="footer-text">心悦君兮 · 念你无歇</div>
        </div>
    </div>

    <!-- 惊喜弹窗（情书样式） -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <div class="modal-header-deco"></div>
            <div class="modal-letter">
                <!-- 称呼 - 左上角，可修改 -->
                <div class="modal-addressee">致心上人 · 笪鸣璨</div>
                <span class="modal-icon">💌</span>
                <!-- 弹窗情话 - 可修改文案 -->
                <div class="modal-text" id="modalText">
                    浮世三千，<br>吾爱有三：<br>日、月与卿。<br>日为朝，月为暮，<br>卿为朝朝暮暮。
                </div>
                <div class="modal-divider"></div>
                <!-- 落款 - 右下角，可修改 -->
                <div class="modal-signature">
                    <span class="sig-line">落笔为念</span>
                    <span class="sig-line sig-name">曹英俊</span>
                </div>
            </div>
            <div class="modal-footer-deco"></div>
            <div style="padding: 0 28px 24px; text-align: center;">
                <button class="modal-close" id="modalClose">知悉 · 珍藏于心</button>
            </div>
        </div>
    </div>

    <!-- 长按彩蛋内容 -->
    <div class="easter-egg-content" id="easterEggContent">
        <div class="easter-egg-inner">
            <div class="egg-rose-bg"></div>
            <!-- 四角古典装饰 -->
            <div class="egg-corner-tl"></div>
            <div class="egg-corner-tr"></div>
            <div class="egg-corner-bl"></div>
            <div class="egg-corner-br"></div>
            <!-- 顶部图标 -->
            <span class="egg-top-icon">❤️</span>
            <span class="egg-text-line"></span>
            <div class="easter-egg-text">
                起点是你，<br>
                过程是你，<br>
                终点是你，<br>
                永远都是你。<br>
                你心念之花，<br>
                永不凋零；<br>
                你心念之人，<br>
                永在身旁。
            </div>
            <span class="egg-text-line"></span>
            <div class="easter-egg-deco">— 心有所念 · 必有回响 —</div>
        </div>
    </div>

    <script>
        /* ========================================
         *  全局变量与配置 - 可在此修改文案
         * ======================================== */

        // 打字机情话列表 - 可修改/增加
        const typewriterPhrases = [
            "温酒煮茶，与你岁岁",
            "心悦于你，无问西东",
            "初见亦乍欢，久处亦怦然",
            "南方有嘉木，北方有相思",
            "日月星辰，不及你",
            "不早不晚，刚好是你",
            "好好生活，慢慢爱你",
            "情不知所起，一往而深",
            "故事很长，一生很短"
        ];

        // 惊喜弹窗情话列表 - 随机显示一句
        const surpriseTexts = [
            "浮世三千，<br>吾爱有三：<br>日、月与卿。<br>日为朝，月为暮，<br>卿为朝朝暮暮。",
            "与你共度的每一秒，<br>都是时光赠予我的，<br>最珍贵的礼物。",
            "我喜欢你，是可以喜欢很久很久的那种喜欢。<br>是夏天过去了还有秋天，是新鲜感过去了还有热忱的那种喜欢。",
            "遇见你的那一刻，<br>似宇宙大爆炸的奇点，<br>自此时间开始，<br>万物生辉。",
            "愿将世间所有美好，<br>与你一同分享，<br>直到永远。",
            "让时间证明，<br>我们的爱不是一时兴起，<br>而是陪伴到底。",
            "是微风，是晚霞，<br>是心跳，是无可替代。",
            "人生，缘始于“遇见”，<br>情长于“陪伴”，<br>陪伴是我能给你最好的礼物。",
            "爱情不是寻找一个完美的人，<br>而是学会用完美的眼光看待不完美的人。",
            "最美好的爱情，<br>不是玫瑰与惊喜，<br>而是你来了以后，<br>再也没走。"
        ];

        // 情人节目标日期 - 2026年2月14日
        const valentineDate = new Date('2026-02-14T00:00:00');

        /* ========================================
         *  页面加载完成
         * ======================================== */
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('pageLoader').classList.add('hidden');
            }, 1200);

            initStars();
            initPetals();
            initTypewriter();
            initCountdown();
            initParticles();
            initSurprise();
            initEasterEgg();
            initRoseClick();
            initMusic();
            initCardSounds();
        });

        /* ========================================
         *  星星闪烁效果
         * ======================================== */
        function initStars() {
            const canvas = document.getElementById('starsCanvas');
            const ctx = canvas.getContext('2d');
            let stars = [];
            let shootingStars = [];
            const STAR_COUNT = 250;

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                // 重新分布星星位置
                stars.forEach(s => {
                    s.x = Math.random() * canvas.width;
                    s.y = Math.random() * canvas.height;
                });
            }
            resize();
            window.addEventListener('resize', resize);

            // 创建星星 - 不同类型有不同闪烁行为
            for (let i = 0; i < STAR_COUNT; i++) {
                const r = Math.random();
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    baseSize: Math.random() * 2.2 + 0.4,
                    maxOpacity: 0.3 + Math.random() * 0.7,
                    // 闪烁速度：快中慢三档，让星空有层次感
                    twinkleSpeed: r < 0.3 ? (1.5 + Math.random() * 2) : r < 0.7 ? (3 + Math.random() * 3) : (5 + Math.random() * 4),
                    phase: Math.random() * Math.PI * 2,
                    // 随机闪烁偏移，让每颗星独立
                    flickerTimer: Math.random() * 1000,
                    // 是否会突然闪亮
                    canFlash: Math.random() < 0.15,
                    flashTime: 0,
                    // 颜色
                    r: Math.random() > 0.5 ? (150 + Math.random()*60) : (180 + Math.random()*40),
                    g: Math.random() > 0.5 ? (190 + Math.random()*50) : (160 + Math.random()*40),
                    b: Math.random() > 0.5 ? 255 : (220 + Math.random()*35)
                });
            }

            // 偶尔产生流星
            function spawnShootingStar() {
                shootingStars.push({
                    x: Math.random() * canvas.width * 0.8,
                    y: Math.random() * canvas.height * 0.3,
                    len: 60 + Math.random() * 80,
                    speed: 4 + Math.random() * 4,
                    angle: Math.PI / 4 + (Math.random() - 0.5) * 0.3,
                    life: 1.0
                });
                // 下一颗流星间隔 4~10秒
                setTimeout(spawnShootingStar, 4000 + Math.random() * 6000);
            }
            setTimeout(spawnShootingStar, 2000);

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const time = Date.now() * 0.001;

                stars.forEach(star => {
                    // 多层正弦叠加，产生自然闪烁
                    const t1 = Math.sin(time * star.twinkleSpeed + star.phase);
                    const t2 = Math.sin(time * star.twinkleSpeed * 0.7 + star.phase * 1.3);
                    let twinkle = (t1 * 0.5 + t2 * 0.3 + 0.8) * 0.6;
                    twinkle = Math.max(0.05, Math.min(1, twinkle));

                    // 随机突然闪亮效果
                    let flashBoost = 0;
                    if (star.canFlash) {
                        if (star.flashTime <= 0 && Math.random() < 0.002) {
                            star.flashTime = 0.4 + Math.random() * 0.3;
                        }
                        if (star.flashTime > 0) {
                            flashBoost = Math.sin(star.flashTime * Math.PI / 0.7) * 0.6;
                            star.flashTime -= 0.016;
                        }
                    }

                    const alpha = Math.min(1, star.maxOpacity * twinkle + flashBoost);
                    const size = star.baseSize * (0.8 + twinkle * 0.4 + flashBoost * 0.5);

                    // 画星星核心
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${alpha})`;
                    ctx.fill();

                    // 较大的星星画十字光芒
                    if (size > 1.8 || flashBoost > 0.2) {
                        const glowAlpha = alpha * 0.4;
                        const glowLen = size * 3;
                        ctx.strokeStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${glowAlpha})`;
                        ctx.lineWidth = 0.5;
                        ctx.beginPath();
                        ctx.moveTo(star.x - glowLen, star.y);
                        ctx.lineTo(star.x + glowLen, star.y);
                        ctx.moveTo(star.x, star.y - glowLen);
                        ctx.lineTo(star.x, star.y + glowLen);
                        ctx.stroke();
                    }

                    // 光晕
                    if (size > 1.5) {
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, size * 2.5, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${alpha * 0.1})`;
                        ctx.fill();
                    }
                });

                // 绘制流星
                shootingStars.forEach((ss, idx) => {
                    const dx = Math.cos(ss.angle) * ss.speed;
                    const dy = Math.sin(ss.angle) * ss.speed;
                    ss.x += dx;
                    ss.y += dy;
                    ss.life -= 0.012;

                    if (ss.life > 0) {
                        const tailX = ss.x - Math.cos(ss.angle) * ss.len;
                        const tailY = ss.y - Math.sin(ss.angle) * ss.len;
                        const grad = ctx.createLinearGradient(tailX, tailY, ss.x, ss.y);
                        grad.addColorStop(0, `rgba(160, 200, 255, 0)`);
                        grad.addColorStop(1, `rgba(200, 220, 255, ${ss.life * 0.8})`);
                        ctx.beginPath();
                        ctx.moveTo(tailX, tailY);
                        ctx.lineTo(ss.x, ss.y);
                        ctx.strokeStyle = grad;
                        ctx.lineWidth = 1.5;
                        ctx.stroke();
                        // 流星头部亮点
                        ctx.beginPath();
                        ctx.arc(ss.x, ss.y, 2, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(220, 240, 255, ${ss.life})`;
                        ctx.fill();
                    } else {
                        shootingStars.splice(idx, 1);
                    }
                });

                requestAnimationFrame(animate);
            }
            animate();
        }

        /* ========================================
         *  飘落花瓣动画
         * ======================================== */
        function initPetals() {
            const container = document.getElementById('petalsContainer');
            const PETAL_COUNT = 15;

            function createPetal() {
                const petal = document.createElement('div');
                petal.className = 'petal';

                // 随机位置和大小
                const left = Math.random() * 100;
                const size = Math.random() * 8 + 8;
                const duration = Math.random() * 8 + 8;
                const delay = Math.random() * 10;
                const swayAmount = (Math.random() - 0.5) * 150;

                petal.style.left = left + '%';
                petal.style.width = size + 'px';
                petal.style.height = (size * 1.3) + 'px';
                petal.style.animationDuration = duration + 's';
                petal.style.animationDelay = delay + 's';

                // 随机花瓣颜色（碎冰蓝系列）
                const hue = 195 + Math.random() * 20;
                const sat = 70 + Math.random() * 20;
                const light = 75 + Math.random() * 15;
                petal.style.background = `radial-gradient(ellipse at 30% 30%, hsla(${hue}, ${sat}%, ${light}%, 0.9), hsla(${hue}, ${sat}%, ${light - 20}%, 0.4))`;

                container.appendChild(petal);

                // 动画结束后重新创建
                petal.addEventListener('animationend', () => {
                    petal.remove();
                    createPetal();
                });

                // 超时清理（防止动画不触发）
                setTimeout(() => {
                    if (petal.parentNode) {
                        petal.remove();
                        createPetal();
                    }
                }, (duration + delay) * 1000 + 500);
            }

            for (let i = 0; i < PETAL_COUNT; i++) {
                setTimeout(() => createPetal(), i * 600);
            }
        }

        /* ========================================
         *  鼠标跟随星光粒子
         * ======================================== */
        function initParticles() {
            const container = document.getElementById('particleContainer');
            let lastTime = 0;
            const THROTTLE = 40; // 节流间隔ms

            function createParticle(x, y) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                const size = Math.random() * 6 + 3;
                const offsetX = (Math.random() - 0.5) * 20;
                const offsetY = (Math.random() - 0.5) * 20;

                // 青紫渐变色
                const colors = [
                    'rgba(130, 200, 255, 0.8)',
                    'rgba(160, 140, 220, 0.8)',
                    'rgba(100, 180, 240, 0.8)',
                    'rgba(180, 160, 255, 0.7)',
                    'rgba(140, 220, 255, 0.8)'
                ];
                const color = colors[Math.floor(Math.random() * colors.length)];

                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = (x + offsetX) + 'px';
                particle.style.top = (y + offsetY) + 'px';
                particle.style.background = `radial-gradient(circle, ${color}, transparent)`;
                particle.style.boxShadow = `0 0 ${size}px ${color}`;

                container.appendChild(particle);

                setTimeout(() => particle.remove(), 1000);
            }

            document.addEventListener('mousemove', (e) => {
                const now = Date.now();
                if (now - lastTime < THROTTLE) return;
                lastTime = now;

                for (let i = 0; i < 3; i++) {
                    createParticle(e.clientX, e.clientY);
                }
            });

            // 触摸设备支持
            document.addEventListener('touchmove', (e) => {
                const now = Date.now();
                if (now - lastTime < THROTTLE) return;
                lastTime = now;

                const touch = e.touches[0];
                for (let i = 0; i < 2; i++) {
                    createParticle(touch.clientX, touch.clientY);
                }
            }, { passive: true });
        }

        /* ========================================
         *  打字机效果
         * ======================================== */
        function initTypewriter() {
            const textEl = document.getElementById('typewriterText');
            let phraseIndex = 0;
            let charIndex = 0;
            let isDeleting = false;

            function type() {
                const currentPhrase = typewriterPhrases[phraseIndex];

                if (!isDeleting) {
                    // 打字
                    textEl.textContent = currentPhrase.substring(0, charIndex + 1);
                    charIndex++;

                    if (charIndex === currentPhrase.length) {
                        // 打完一句，停顿后开始删除
                        setTimeout(() => {
                            isDeleting = true;
                            type();
                        }, 2500);
                        return;
                    }
                    setTimeout(type, 150);
                } else {
                    // 删除
                    textEl.textContent = currentPhrase.substring(0, charIndex - 1);
                    charIndex--;

                    if (charIndex === 0) {
                        isDeleting = false;
                        phraseIndex = (phraseIndex + 1) % typewriterPhrases.length;
                        setTimeout(type, 500);
                        return;
                    }
                    setTimeout(type, 80);
                }
            }

            setTimeout(type, 2000);
        }

        /* ========================================
         *  情人节倒计时
         * ======================================== */
        function initCountdown() {
            const daysEl = document.getElementById('cdDays');
            const hoursEl = document.getElementById('cdHours');
            const minsEl = document.getElementById('cdMins');
            const secsEl = document.getElementById('cdSecs');
            const label = document.querySelector('.countdown-label');
            const units = document.querySelectorAll('.countdown-unit');

            // 情人节当天的起止时间
            const vStart = new Date('2026-02-14T00:00:00');
            const vEnd = new Date('2026-02-15T00:00:00');

            function update() {
                const now = new Date();

                if (now < vStart) {
                    // ---- 情人节之前：正常倒计时 ----
                    units.forEach(function(u) { u.style.display = ''; });
                    label.textContent = '— 距离情人节 —';
                    const diff = vStart - now;
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const secs = Math.floor((diff % (1000 * 60)) / 1000);
                    daysEl.textContent = days;
                    hoursEl.textContent = String(hours).padStart(2, '0');
                    minsEl.textContent = String(mins).padStart(2, '0');
                    secsEl.textContent = String(secs).padStart(2, '0');
                } else if (now < vEnd) {
                    // ---- 情人节当天：显示鸣璨宝宝 ----
                    label.textContent = '— 情人节快乐 —';
                    units.forEach(function(u) { u.style.display = 'none'; });
                    daysEl.textContent = '鸣';
                    hoursEl.textContent = '璨';
                    minsEl.textContent = '宝';
                    secsEl.textContent = '宝';
                } else {
                    // ---- 情人节之后：显示已过去的时间 ----
                    units.forEach(function(u) { u.style.display = ''; });
                    label.textContent = '— 距第1个情人节已过 —';
                    const elapsed = now - vStart;
                    const days = Math.floor(elapsed / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((elapsed % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const mins = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                    const secs = Math.floor((elapsed % (1000 * 60)) / 1000);
                    daysEl.textContent = days;
                    hoursEl.textContent = String(hours).padStart(2, '0');
                    minsEl.textContent = String(mins).padStart(2, '0');
                    secsEl.textContent = String(secs).padStart(2, '0');
                }
            }

            update();
            setInterval(update, 1000);
        }

        /* ========================================
         *  音效播放工具（预加载）
         * ======================================== */
        var sfxCache = {};
        var sfxList = [
            'mp3/蟋蟀音效.mp3',
            'mp3/平静的海滩海浪.mp3',
            'mp3/风铃音效.mp3',
            'mp3/翻书音效.mp3',
            'mp3/人声分离增加音量.mp3'
        ];
        sfxList.forEach(function(src) {
            var a = new Audio(src);
            a.preload = 'auto';
            a.load();
            sfxCache[src] = a;
        });

        function playSfx(src, volume) {
            var cached = sfxCache[src];
            if (cached) {
                var a = cached.cloneNode();
                a.volume = volume || 0.5;
                a.play().catch(function(){});
                a.addEventListener('ended', function() { a.remove && a.remove(); });
            } else {
                var a = new Audio(src);
                a.volume = volume || 0.5;
                a.play().catch(function(){});
            }
        }

        /* ========================================
         *  卡片悬浮音效
         * ======================================== */
        function initCardSounds() {
            const cards = document.querySelectorAll('.glass-card');
            const soundMap = [
                'mp3/蟋蟀音效.mp3',
                'mp3/平静的海滩海浪.mp3',
                'mp3/风铃音效.mp3'
            ];
            cards.forEach(function(card, idx) {
                if (soundMap[idx]) {
                    card.addEventListener('mouseenter', function() {
                        playSfx(soundMap[idx], 0.45);
                    });
                }
            });
        }

        /* ========================================
         *  惊喜弹窗
         * ======================================== */
        function initSurprise() {
            const btn = document.getElementById('surpriseBtn');
            const overlay = document.getElementById('modalOverlay');
            const closeBtn = document.getElementById('modalClose');
            const modalText = document.getElementById('modalText');

            btn.addEventListener('click', () => {
                playSfx('mp3/翻书音效.mp3', 0.5);
                // 随机选择一句情话
                const randomText = surpriseTexts[Math.floor(Math.random() * surpriseTexts.length)];
                modalText.innerHTML = randomText;
                overlay.classList.add('active');
            });

            closeBtn.addEventListener('click', () => {
                overlay.classList.remove('active');
            });

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        }

        /* ========================================
         *  长按彩蛋
         * ======================================== */
        function initEasterEgg() {
            const zone = document.getElementById('easterEggZone');
            const content = document.getElementById('easterEggContent');
            let pressTimer = null;
            let isShowing = false;
            let justShown = false;

            // ---- 玫瑰花瓣飘落 ----
            var petalImages = [
                '玫瑰花瓣1.png', '260玫瑰花瓣.png', '星星.png',
                '玫瑰花瓣4.png', '3d爱心.png'
            ];
            var leafImages = [
                '红心.png', '镭射爱心.png', '爱心.png'
            ];
            var rainContainer = null;

            function startRoseRain() {
                if (rainContainer) return;
                rainContainer = document.createElement('div');
                rainContainer.className = 'rose-rain';
                document.body.appendChild(rainContainer);

                // 花瓣 30 片 + 叶子 8 片
                var totalPetals = 21;
                var totalLeaves = 5;

                for (var i = 0; i < totalPetals + totalLeaves; i++) {
                    var el = document.createElement('div');
                    el.className = 'rose-petal';

                    var isLeaf = i >= totalPetals;
                    var img = isLeaf
                        ? leafImages[Math.floor(Math.random() * leafImages.length)]
                        : petalImages[Math.floor(Math.random() * petalImages.length)];

                    // 花瓣小巧，叶子稍大
                    var size = isLeaf
                        ? (18 + Math.random() * 14)
                        : (14 + Math.random() * 18);

                    el.style.width = size + 'px';
                    el.style.height = size + 'px';
                    el.style.left = (Math.random() * 100) + '%';
                    el.style.backgroundImage = 'url(./' + img + ')';

                    // 随机参数：飘落时长、摇摆幅度、旋转方向
                    var fallDur = (8 + Math.random() * 10).toFixed(1);
                    var fallDelay = (Math.random() * 6).toFixed(1);
                    var swayDur = (2 + Math.random() * 3).toFixed(1);
                    var swayRange = (15 + Math.random() * 40).toFixed(0);
                    var spinDur = (4 + Math.random() * 8).toFixed(1);
                    var spinDir = Math.random() > 0.5 ? '360deg' : '-360deg';
                    var petalOpacity = isLeaf
                        ? (0.35 + Math.random() * 0.25).toFixed(2)
                        : (0.5 + Math.random() * 0.4).toFixed(2);

                    el.style.setProperty('--fall-dur', fallDur + 's');
                    el.style.setProperty('--fall-delay', fallDelay + 's');
                    el.style.setProperty('--sway-dur', swayDur + 's');
                    el.style.setProperty('--sway-range', swayRange + 'px');
                    el.style.setProperty('--spin-dur', spinDur + 's');
                    el.style.setProperty('--spin-dir', spinDir);
                    el.style.setProperty('--petal-opacity', petalOpacity);

                    rainContainer.appendChild(el);
                }
            }

            function stopRoseRain() {
                if (!rainContainer) return;
                var rc = rainContainer;
                rc.classList.add('fading');
                rainContainer = null;
                setTimeout(function() {
                    if (rc.parentNode) rc.parentNode.removeChild(rc);
                }, 1300);
            }

            function showEgg() {
                playSfx('mp3/人声分离增加音量.mp3', 0.5);
                content.classList.add('show');
                isShowing = true;
                startRoseRain();
                // 防止松手后的click事件立即关闭卡片
                justShown = true;
                setTimeout(function() { justShown = false; }, 2500);
            }

            function hideEgg() {
                content.classList.remove('show');
                isShowing = false;
                stopRoseRain();
            }

            // 鼠标长按
            zone.addEventListener('mousedown', (e) => {
                e.preventDefault();
                pressTimer = setTimeout(showEgg, 800);
            });

            zone.addEventListener('mouseup', () => {
                clearTimeout(pressTimer);
            });

            zone.addEventListener('mouseleave', () => {
                clearTimeout(pressTimer);
            });

            // 触摸长按
            zone.addEventListener('touchstart', (e) => {
                e.preventDefault();
                pressTimer = setTimeout(showEgg, 800);
            }, { passive: false });

            zone.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
            });

            // 点击其他区域关闭彩蛋
            document.addEventListener('click', (e) => {
                if (justShown) return;
                if (isShowing && !content.contains(e.target) && !zone.contains(e.target)) {
                    hideEgg();
                }
            });

            document.addEventListener('touchstart', (e) => {
                if (justShown) return;
                if (isShowing && !content.contains(e.target) && !zone.contains(e.target)) {
                    hideEgg();
                }
            }, { passive: true });
        }

        /* ========================================
         *  点击玫瑰 - 爱心+花瓣爆破 + 卡农钢琴演奏
         * ======================================== */
        function initRoseClick() {
            const roseWrapper = document.getElementById('roseWrapper');

            // 致爱丽丝 Für Elise 简化单音版
            // 每点一次玫瑰弹一个音，小白也能轻松弹出致爱丽丝
            const canonNotes = [
                // ===== 主题（最经典的开头） =====
                'p_56_e5',   // E5
                'p_55_dz5',  // D#5
                'p_56_e5',   // E5
                'p_55_dz5',  // D#5
                'p_56_e5',   // E5
                'p_51_b4',   // B4
                'p_54_d5',   // D5
                'p_52_c5',   // C5
                'p_49_a4',   // A4  (第一句结束)

                // ===== 低音衔接 =====
                'p_40_c4',   // C4
                'p_44_e4',   // E4
                'p_49_a4',   // A4
                'p_51_b4',   // B4  (第二句结束)

                // ===== 回到主题动机 =====
                'p_44_e4',   // E4
                'p_48_gz4',  // G#4
                'p_51_b4',   // B4
                'p_52_c5',   // C5  (第三句结束)

                // ===== 主题再现 =====
                'p_44_e4',   // E4
                'p_56_e5',   // E5
                'p_55_dz5',  // D#5
                'p_56_e5',   // E5
                'p_55_dz5',  // D#5
                'p_56_e5',   // E5
                'p_51_b4',   // B4
                'p_54_d5',   // D5
                'p_52_c5',   // C5
                'p_49_a4',   // A4  (第四句结束)

                // ===== 低音衔接（重复） =====
                'p_40_c4',   // C4
                'p_44_e4',   // E4
                'p_49_a4',   // A4
                'p_51_b4',   // B4  (第五句结束)

                // ===== 收尾乐句 =====
                'p_44_e4',   // E4
                'p_52_c5',   // C5
                'p_51_b4',   // B4
                'p_49_a4',   // A4  (A段结束)
            ];

            // ---- Web Audio API：移动端可靠播放 ----
            var pianoCtx = null;
            var bufferCache = {};
            var noteIndex = 0;
            var autoPlayTimer = null;
            var pressTimer = null;
            var isAutoPlaying = false;
            var touchStartTime = 0;
            var longPressTriggered = false;

            function getPianoCtx() {
                if (!pianoCtx) {
                    pianoCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (pianoCtx.state === 'suspended') {
                    pianoCtx.resume();
                }
                return pianoCtx;
            }

            // 预加载：fetch + decodeAudioData 缓存为 AudioBuffer
            var uniqueNotes = [...new Set(canonNotes)];
            uniqueNotes.forEach(function(note) {
                fetch('piano/' + note + '.mp3')
                    .then(function(r) { return r.arrayBuffer(); })
                    .then(function(buf) {
                        return getPianoCtx().decodeAudioData(buf);
                    })
                    .then(function(decoded) {
                        bufferCache[note] = decoded;
                    })
                    .catch(function(){});
            });

            function playPianoNote() {
                var ctx = getPianoCtx();
                var note = canonNotes[noteIndex % canonNotes.length];
                var buffer = bufferCache[note];
                if (buffer) {
                    var source = ctx.createBufferSource();
                    source.buffer = buffer;
                    var gain = ctx.createGain();
                    gain.gain.value = 0.7;
                    source.connect(gain);
                    gain.connect(ctx.destination);
                    source.start(0);
                }
                noteIndex++;
            }

            function triggerBurst() {
                var rect = roseWrapper.getBoundingClientRect();
                var cx = rect.left + rect.width / 2;
                var cy = rect.top + rect.height / 2;
                createBurst(cx, cy);
            }

            function onTap() {
                if (isAutoPlaying) return;
                playPianoNote();
                triggerBurst();
            }

            function startAutoPlay() {
                isAutoPlaying = true;
                noteIndex = 0;
                var totalNotes = canonNotes.length;
                playPianoNote();
                triggerBurst();
                var played = 1;
                autoPlayTimer = setInterval(function() {
                    if (played >= totalNotes) {
                        clearInterval(autoPlayTimer);
                        autoPlayTimer = null;
                        isAutoPlaying = false;
                        noteIndex = 0;
                        return;
                    }
                    playPianoNote();
                    triggerBurst();
                    played++;
                }, 320);
            }

            function cancelPress() {
                if (pressTimer) {
                    clearTimeout(pressTimer);
                    pressTimer = null;
                }
            }

            // 防止长按触发文本选择（纯CSS方式，不影响事件）
            roseWrapper.style.userSelect = 'none';
            roseWrapper.style.webkitUserSelect = 'none';
            roseWrapper.style.webkitTouchCallout = 'none';

            // ---- 桌面端：mousedown/mouseup/click ----
            roseWrapper.addEventListener('mousedown', function() {
                if (isAutoPlaying) return;
                pressTimer = setTimeout(function() {
                    pressTimer = null;
                    startAutoPlay();
                }, 800);
            });
            roseWrapper.addEventListener('mouseup', cancelPress);
            roseWrapper.addEventListener('mouseleave', cancelPress);
            roseWrapper.addEventListener('click', function(e) {
                if (isAutoPlaying) return;
                onTap();
            });

            // ---- 移动端：touchstart/touchend 手动判断点击/长按 ----
            roseWrapper.addEventListener('touchstart', function(e) {
                // 初始化AudioContext（移动端需要用户手势）
                getPianoCtx();
                longPressTriggered = false;
                touchStartTime = Date.now();
                if (isAutoPlaying) return;
                pressTimer = setTimeout(function() {
                    pressTimer = null;
                    longPressTriggered = true;
                    startAutoPlay();
                }, 800);
            }, { passive: true });

            roseWrapper.addEventListener('touchend', function(e) {
                cancelPress();
                // 短按 = 点击弹一个音
                if (!longPressTriggered && !isAutoPlaying && (Date.now() - touchStartTime < 800)) {
                    e.preventDefault(); // 仅在短按时阻止，防止触发额外click
                    onTap();
                }
            });
            roseWrapper.addEventListener('touchcancel', cancelPress);

            // 阻止长按弹出上下文菜单
            roseWrapper.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        }

        function createBurst(cx, cy) {
            const PARTICLE_COUNT = 20;

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const el = document.createElement('div');
                el.className = 'burst-particle';

                // 随机方向
                const angle = (Math.PI * 2 * i) / PARTICLE_COUNT + (Math.random() - 0.5) * 0.5;
                const distance = 60 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance - 30;
                const rot = Math.random() * 720 - 360;

                el.style.left = cx + 'px';
                el.style.top = cy + 'px';
                el.style.setProperty('--tx', tx + 'px');
                el.style.setProperty('--ty', ty + 'px');
                el.style.setProperty('--rot', rot + 'deg');

                // 交替爱心和花瓣
                if (i % 3 === 0) {
                    el.innerHTML = '<span class="burst-heart">♥</span>';
                    // 碎冰蓝渐变色
                    const hue = 195 + Math.random() * 30;
                    el.querySelector('.burst-heart').style.color = `hsl(${hue}, 80%, 75%)`;
                    el.querySelector('.burst-heart').style.textShadow = `0 0 10px hsla(${hue}, 80%, 75%, 0.6)`;
                    el.querySelector('.burst-heart').style.fontSize = (16 + Math.random() * 12) + 'px';
                } else {
                    const petal = document.createElement('div');
                    petal.className = 'burst-petal-piece';
                    const size = 6 + Math.random() * 8;
                    petal.style.width = size + 'px';
                    petal.style.height = (size * 1.4) + 'px';
                    const hue = 195 + Math.random() * 30;
                    petal.style.background = `linear-gradient(135deg, hsla(${hue}, 80%, 75%, 0.9), hsla(${hue + 30}, 60%, 65%, 0.6))`;
                    el.appendChild(petal);
                }

                document.body.appendChild(el);

                // 动画结束后移除
                setTimeout(() => el.remove(), 1300);
            }
        }

        /* ========================================
         *  背景音乐控制 + 圆形播放器
         * ======================================== */
        function initMusic() {
            var btn = document.getElementById('musicBtn');
            var icon = btn.querySelector('.music-icon');
            var overlay = document.getElementById('mpOverlay');
            var card = document.getElementById('mpCard');
            var songNameEl = document.getElementById('mpSongName');
            var artistEl = document.getElementById('mpArtist');
            var lyricsInner = document.getElementById('mpLyricsInner');
            var coverImg = document.getElementById('mpCoverImg');
            var playBtn = document.getElementById('mpPlayBtn');
            var centerArea = document.getElementById('mpCenterArea');
            var prevArrow = document.getElementById('mpPrev');
            var nextArrow = document.getElementById('mpNext');
            var progressBar = document.getElementById('mpProgressBar');
            var progressFill = document.getElementById('mpProgressFill');
            var timeCur = document.getElementById('mpTimeCur');
            var timeDur = document.getElementById('mpTimeDur');
            var volBar = document.getElementById('mpVolBar');
            var volFill = document.getElementById('mpVolFill');
            var lrcToggle = document.getElementById('mpLrcToggle');
            var globalBar = document.getElementById('globalLyricsBar');
            var globalText = document.getElementById('globalLyricText');

            // ---- 歌曲列表 ----
            var tracks = [
                { name: '七里香', artist: '周杰伦', src: './mp3/七里香.mp3', lrc: './lrc/七里香.lrc', cover: './pic/七里香.webp' },
                { name: 'Kiss Me', artist: 'Nai Br.XX', src: 'https://v.iarc.top/?type=url&id=1368227453', lrc: 'https://v.iarc.top/?type=lrc&id=1368227453', cover: './pic/KissMe.webp' },
                { name: '唯一', artist: '邓紫棋', src: 'https://v.iarc.top/?type=url&id=2083785152', lrc: 'https://v.iarc.top/?type=lrc&id=2083785152', cover: './pic/唯一.webp' }
            ];

            var currentIndex = 0;
            var audio = new Audio();
            audio.preload = 'auto';
            audio.loop = false;
            var volume = 0.3;
            audio.volume = volume;
            var isPlaying = false;
            var showGlobalLrc = false;
            var parsedLyrics = [];
            var currentLyricIdx = -1;
            var playerOpen = false;
            var mpPressTimer = null;
            var mpLongPressed = false;
            var mpTouchStart = 0;
            var playBtnTimer = null;

            // ---- LRC 解析 ----
            function parseLRC(text) {
                var lines = text.split('\n');
                var result = [];
                for (var i = 0; i < lines.length; i++) {
                    var match = lines[i].match(/\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\](.*)/);
                    if (match) {
                        var min = parseInt(match[1]);
                        var sec = parseInt(match[2]);
                        var ms = match[3] ? parseInt(match[3].length === 2 ? match[3] + '0' : match[3]) : 0;
                        var time = min * 60 + sec + ms / 1000;
                        var txt = match[4].trim();
                        if (txt) result.push({ time: time, text: txt });
                    }
                }
                result.sort(function(a, b) { return a.time - b.time; });
                return result;
            }

            function loadLRC(url) {
                fetch(url)
                    .then(function(r) { return r.ok ? r.text() : ''; })
                    .then(function(text) {
                        parsedLyrics = text ? parseLRC(text) : [];
                        currentLyricIdx = -1;
                        renderLyrics();
                    })
                    .catch(function() {
                        parsedLyrics = [];
                        currentLyricIdx = -1;
                        renderLyrics();
                    });
            }

            function renderLyrics() {
                lyricsInner.innerHTML = '';
                if (parsedLyrics.length === 0) {
                    var p = document.createElement('div');
                    p.className = 'mp-lyric-line';
                    p.textContent = '暂无歌词';
                    lyricsInner.appendChild(p);
                    return;
                }
                for (var i = 0; i < parsedLyrics.length; i++) {
                    var p = document.createElement('div');
                    p.className = 'mp-lyric-line';
                    p.textContent = parsedLyrics[i].text;
                    lyricsInner.appendChild(p);
                }
            }

            function updateLyricScroll() {
                if (parsedLyrics.length === 0) return;
                var t = audio.currentTime;
                var idx = -1;
                for (var i = 0; i < parsedLyrics.length; i++) {
                    if (parsedLyrics[i].time <= t) idx = i;
                    else break;
                }
                if (idx === currentLyricIdx) return;
                currentLyricIdx = idx;

                var lines = lyricsInner.querySelectorAll('.mp-lyric-line');
                for (var i = 0; i < lines.length; i++) {
                    lines[i].classList.toggle('active', i === idx);
                }

                // 滚动居中
                if (idx >= 0) {
                    var lineH = lines[0] ? lines[0].offsetHeight : 20;
                    var boxH = lyricsInner.parentElement.offsetHeight;
                    var scrollY = idx * lineH - boxH / 2 + lineH / 2;
                    lyricsInner.style.transform = 'translateY(' + (-Math.max(0, scrollY)) + 'px)';
                }

                // 全局底部歌词
                if (showGlobalLrc && idx >= 0) {
                    globalText.textContent = parsedLyrics[idx].text;
                }
            }

            // ---- 加载歌曲 ----
            function loadTrack(index, autoplay) {
                currentIndex = index;
                var track = tracks[index];
                audio.src = track.src;
                audio.load();
                songNameEl.textContent = track.name;
                artistEl.textContent = track.artist;
                coverImg.src = track.cover;
                loadLRC(track.lrc);
                progressFill.style.width = '0%';
                timeCur.textContent = '0:00';
                timeDur.textContent = '0:00';
                currentLyricIdx = -1;

                if (autoplay) {
                    audio.play().then(function() {
                        isPlaying = true;
                        btn.classList.add('playing');
                        card.classList.add('playing');
                        playBtn.textContent = '⏸';
                        scheduleHidePlayBtn();
                    }).catch(function() {});
                } else {
                    showPlayBtn();
                }
            }

            // ---- 播放按钮显示/隐藏 ----
            function showPlayBtn() {
                if (playBtnTimer) { clearTimeout(playBtnTimer); playBtnTimer = null; }
                playBtn.classList.remove('hidden');
            }

            function scheduleHidePlayBtn(delay) {
                if (playBtnTimer) clearTimeout(playBtnTimer);
                playBtnTimer = setTimeout(function() {
                    if (isPlaying) {
                        playBtn.classList.add('hidden');
                        centerTouchShown = false;
                    }
                }, delay || 1000);
            }

            // ---- 播放/暂停 ----
            function togglePlay() {
                if (isPlaying) {
                    audio.pause();
                    isPlaying = false;
                    btn.classList.remove('playing');
                    card.classList.remove('playing');
                    playBtn.textContent = '▶';
                    showPlayBtn();
                } else {
                    audio.play().then(function() {
                        isPlaying = true;
                        btn.classList.add('playing');
                        card.classList.add('playing');
                        playBtn.textContent = '||';
                        scheduleHidePlayBtn();
                    }).catch(function() {});
                }
            }

            // ---- 切歌 ----
            function prevTrack() {
                var idx = (currentIndex - 1 + tracks.length) % tracks.length;
                loadTrack(idx, isPlaying);
            }

            function nextTrack() {
                var idx = (currentIndex + 1) % tracks.length;
                loadTrack(idx, isPlaying);
            }

            // ---- 时间格式化 ----
            function fmtTime(s) {
                if (isNaN(s)) return '0:00';
                var m = Math.floor(s / 60);
                var sec = Math.floor(s % 60);
                return m + ':' + (sec < 10 ? '0' : '') + sec;
            }

            // ---- 进度更新 ----
            audio.addEventListener('timeupdate', function() {
                if (!audio.duration) return;
                var pct = (audio.currentTime / audio.duration * 100);
                progressFill.style.width = pct + '%';
                timeCur.textContent = fmtTime(audio.currentTime);
                updateLyricScroll();
            });

            audio.addEventListener('loadedmetadata', function() {
                timeDur.textContent = fmtTime(audio.duration);
            });

            // 歌曲播完自动下一首
            audio.addEventListener('ended', function() {
                nextTrack();
            });

            // ---- 进度条点击/拖动跳转 ----
            function seekFromEvent(e) {
                if (!audio.duration) return;
                var rect = progressBar.getBoundingClientRect();
                var clientX = e.touches ? e.touches[0].clientX : e.clientX;
                var pct = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
                audio.currentTime = pct * audio.duration;
                progressFill.style.width = (pct * 100) + '%';
                timeCur.textContent = fmtTime(audio.currentTime);
            }
            var isSeeking = false;
            progressBar.addEventListener('click', function(e) { seekFromEvent(e); });
            progressBar.addEventListener('touchstart', function(e) {
                e.preventDefault();
                e.stopPropagation();
                isSeeking = true;
                seekFromEvent(e);
            }, { passive: false });
            progressBar.addEventListener('touchmove', function(e) {
                if (!isSeeking) return;
                e.preventDefault();
                seekFromEvent(e);
            }, { passive: false });
            progressBar.addEventListener('touchend', function(e) {
                isSeeking = false;
            });

            // ---- 音量控制 ----
            volFill.style.width = (volume * 100) + '%';
            volBar.addEventListener('click', function(e) {
                var rect = volBar.getBoundingClientRect();
                var pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                volume = pct;
                audio.volume = volume;
                volFill.style.width = (pct * 100) + '%';
            });

            // ---- 全局歌词开关 ----
            lrcToggle.addEventListener('click', function() {
                showGlobalLrc = !showGlobalLrc;
                lrcToggle.classList.toggle('on', showGlobalLrc);
                globalBar.classList.toggle('visible', showGlobalLrc);
                if (!showGlobalLrc) {
                    globalText.textContent = '';
                } else if (currentLyricIdx >= 0 && parsedLyrics[currentLyricIdx]) {
                    globalText.textContent = parsedLyrics[currentLyricIdx].text;
                }
            });

            // ---- 按钮事件 ----
            playBtn.addEventListener('click', function(e) { e.stopPropagation(); togglePlay(); });
            // 移动端：触摸歌词区域先显示按钮，再次触摸才暂停
            var centerTouchShown = false;
            centerArea.addEventListener('click', function(e) {
                if (e.target === centerArea || e.target.classList.contains('mp-lyrics-box') || e.target.classList.contains('mp-lyrics-inner') || e.target.classList.contains('mp-lyric-line')) {
                    e.stopPropagation();
                    if (isPlaying && playBtn.classList.contains('hidden') && !centerTouchShown) {
                        // 第一次点击：先显示按钮
                        showPlayBtn();
                        centerTouchShown = true;
                        // 3秒无操作再隐藏
                        scheduleHidePlayBtn(3000);
                        return;
                    }
                    centerTouchShown = false;
                    togglePlay();
                }
            });
            prevArrow.addEventListener('click', function(e) { e.stopPropagation(); prevTrack(); });
            nextArrow.addEventListener('click', function(e) { e.stopPropagation(); nextTrack(); });

            // ---- 打开/关闭播放器 ----
            function openPlayer() {
                playerOpen = true;
                overlay.classList.add('active');
            }

            function closePlayer() {
                playerOpen = false;
                overlay.classList.remove('active');
            }

            // 点击overlay背景关闭（不含卡片和箭头）
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closePlayer();
                }
            });

            // ---- musicBtn：短按播放/暂停，长按打开播放器 ----
            btn.style.userSelect = 'none';
            btn.style.webkitUserSelect = 'none';
            btn.style.webkitTouchCallout = 'none';

            function cancelMpPress() {
                if (mpPressTimer) {
                    clearTimeout(mpPressTimer);
                    mpPressTimer = null;
                }
            }

            // 桌面端
            btn.addEventListener('mousedown', function(e) {
                e.preventDefault();
                mpLongPressed = false;
                mpPressTimer = setTimeout(function() {
                    mpPressTimer = null;
                    mpLongPressed = true;
                    openPlayer();
                }, 600);
            });
            btn.addEventListener('mouseup', cancelMpPress);
            btn.addEventListener('mouseleave', cancelMpPress);
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (mpLongPressed) { mpLongPressed = false; return; }
                togglePlay();
            });

            // 移动端
            btn.addEventListener('touchstart', function(e) {
                mpLongPressed = false;
                mpTouchStart = Date.now();
                mpPressTimer = setTimeout(function() {
                    mpPressTimer = null;
                    mpLongPressed = true;
                    openPlayer();
                }, 600);
            }, { passive: true });
            btn.addEventListener('touchend', function(e) {
                cancelMpPress();
                if (!mpLongPressed && (Date.now() - mpTouchStart < 600)) {
                    e.preventDefault();
                    togglePlay();
                }
            });
            btn.addEventListener('touchcancel', cancelMpPress);
            btn.addEventListener('contextmenu', function(e) { e.preventDefault(); });

            // ---- 初始化：加载第一首并尝试自动播放 ----
            loadTrack(0, false);

            function tryAutoPlay() {
                audio.volume = volume;
                audio.play().then(function() {
                    isPlaying = true;
                    btn.classList.add('playing');
                    card.classList.add('playing');
                    playBtn.textContent = '⏸';
                    scheduleHidePlayBtn();
                }).catch(function() {
                    isPlaying = false;
                    btn.classList.remove('playing');
                    card.classList.remove('playing');
                    playBtn.textContent = '▶';
                    showPlayBtn();
                });
            }

            setTimeout(tryAutoPlay, 1500);

            document.addEventListener('click', function firstClick() {
                if (!isPlaying) tryAutoPlay();
                document.removeEventListener('click', firstClick);
            }, { once: false });
        }
    </script>
</body>
</html>
